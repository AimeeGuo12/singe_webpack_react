<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>echarts使用</title>
    <script src="./echarts.min.js"></script>
    <script type="text/javascript" src="./china.js"></script>

</head>

<body>
    <div id='wrapper' style="width: 600px; height:400px">

    </div>
    <script type="text/javascript">

        function convertData(data) {
            var res = [];
            let Max = 0;
            let l = 0;
            for (var i = 0; i < data.length; i++) {
                let address = [data[i].lng, data[i].lat];
                // var geoCoord = geoCoordMap[data[i].name];
                res.push({
                    executeV: data[i].executeV,
                    org: data[i].orgPk,
                    address: data[i].orgName,
                    name: '',
                    value: address.concat(data[i].value),
                });
                if (data[i].value > Max) {
                    Max = data[i].value
                }
            }

            while (Max > 1) {
                Max = Max / 10;
                l++;
            }
            this.size = Math.pow(10, l - 2);
            return res;
        };
        // 基于准备好的dom 初始化echarts实例
        let myChart = echarts.init(document.getElementById('wrapper'))
        // echarts.registerMap('china')
        // 指定图表的配置项和数据
        let option = {
            title: { text: 'geo实例' },
            tooltip: {
                padding: 0,
                enterable: true,
                transitionDuration: 1,
                textStyle: {
                    color: '#000',
                    decoration: 'none',
                },
                // position: function (point, params, dom, rect, size) {
                //   return [point[0], point[1]];
                // },
                formatter: (params) => {
                    console.log(params)
                    var tipHtml = '';
                    var empty = ''
                    let tipName = params.data ? params.data.address : null
                    let selfV = params.data ? params.data.value && params.data.value[2] : null
                    let executeV = params.data ? params.data.executeV : null
                    tipHtml = '<div style="width:250px;height:90px;background:rgba(250,250,250,0.8);box-shadow:3px 3x 2px #e6e6e6;">'
                        // +'<div style="width:100%;height:40px;line-height:40px;border-bottom:2px solid rgba(200,200,200,0.7);padding:0 20px">'+'<i style="display:inline-block;width:8px;height:8px;background:#16d6ff;border-radius:40px;">'+'</i>'
                        // +'<span style="margin-left:10px;color:#555555;font-size:16px;">'+tipName+'</span>'+'</div>'
                        // '<i style="display:inline-block;width:10px;height:10px;background:#16d6ff;border-radius:40px;margin:0 8px">'+'</i>'
                        + '<div style="padding:10px">'
                        + '<p style="color:#555555;font-size:12px;">' + '<i style="display:inline-block;width:10px;height:10px;background:#3086E3;border-radius:40px;margin:0 8px">' + '</i>'
                        + '单位名称' + '：' + '<span style="color:#555555;margin:0 6px;">' + tipName + '</span></p>'
                        + '<p style="color:#555555;font-size:12px;">' + '<i style="display:inline-block;width:10px;height:10px;background:#3086E3;border-radius:40px;margin:0 8px">' + '</i>'
                        + '单位预算总额' + '：' + '<span style="color:#555555;margin:0 6px;">' + selfV + '</span></p>'
                        + '<p style="color:#555555;font-size:12px;">' + '<i style="display:inline-block;width:10px;height:10px;background:#3086E3;border-radius:40px;margin:0 8px">' + '</i>'
                        + '单位执行总额' + '：' + '<span style="color:#555555;margin:0 6px;">' + executeV + '</span></p>'
                        + '</div>' + '</div>';
                    // setTimeout(function() {
                    //     tooltipCharts(params.name);
                    // }, 10);
                    if (tipName) {
                        return tipHtml;
                    } else {
                        return empty
                    }

                }
            },
            visualMap: {
                show: false,
                min: 0,
                max: 200,
                left: '10%',
                top: 'bottom',
                calculable: true,
                seriesIndex: [1],
                inRange: {
                    color: ['#04387b', '#467bc0'] // 蓝绿
                }
            },
            geo: {
                show: true,
                map: 'china',
                label: {
                    normal: {
                        show: false
                    },
                    emphasis: {
                        show: false,
                    }
                },
                roam: false,
                itemStyle: {
                    normal: {
                        areaColor: '#3086E3',
                        borderColor: '#ffffff',
                    },
                    emphasis: {
                        areaColor: '#65AFFF',
                    }
                }
            },
            series: [{
                name: '中国',
                type: 'map',
                mapType: 'china',
                selectedMode: 'single',
                roam: false,
                label: {
                    normal: {
                        show: true
                    },
                    emphasis: {
                        show: true
                    }
                },
                data: [{
                        name: '北京',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '天津',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '上海',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '重庆',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '河北',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        }
                    },
                    {
                        name: '河南',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {

                        name: '云南',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '辽宁',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '黑龙江',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '湖南',
                        itemStyle: {
                            normal: {
                                areaColor: '#D7EDFB'
                            }
                        }
                    },
                    {
                        name: '安徽',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '山东',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '新疆',
                        itemStyle: {
                            normal: {
                                areaColor: '#D7EDFB'
                            }
                        }
                    },
                    {
                        name: '江苏',
                        itemStyle: {
                            normal: {
                                areaColor: '#D7EDFB'
                            }
                        }
                    },
                    {
                        name: '浙江',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '江西',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '湖北',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        },
                        selected: true
                    },
                    {
                        name: '广西',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '甘肃',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        }
                    },
                    {
                        name: '山西',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '内蒙古',
                        itemStyle: {
                            normal: {
                                areaColor: '#D7EDFB'
                            }
                        }
                    },
                    {
                        name: '陕西',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '吉林',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        }
                    },
                    {
                        name: '福建',
                        itemStyle: {
                            normal: {
                                areaColor: '#D7EDFB'
                            }
                        }
                    },
                    {
                        name: '贵州',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        }
                    },
                    {
                        name: '广东',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '青海',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '西藏',
                        itemStyle: {
                            normal: {
                                areaColor: '#FFFDE4'
                            }
                        }
                    },
                    {
                        name: '四川',
                        itemStyle: {
                            normal: {
                                areaColor: '#D9EDE1'
                            }
                        }
                    },
                    {
                        name: '宁夏',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '海南',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '台湾',
                        itemStyle: {
                            normal: {
                                areaColor: '#FBE0EC'
                            }
                        }
                    },
                    {
                        name: '香港',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '澳门',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    },
                    {
                        name: '南海诸岛',
                        itemStyle: {
                            normal: {
                                areaColor: '#FCE1D8'
                            }
                        }
                    }
                ]
            },
        // ],
            // series: [{
            //     name: '散点',
            //     type: 'scatter',
            //     coordinateSystem: 'geo',
            //     data: this.convertData(data),
            //     symbolSize: function (val) {
            //         if (val[2] == 0) {
            //             return 5
            //         } else {
            //             if (val[2] / 100 < 5) {
            //                 return 5
            //             } else {
            //                 return val[2] / Maxsize;
            //             }
            //         }
            //     },
            //     label: {
            //         normal: {
            //             formatter: '{b}',
            //             position: 'right',
            //             show: true
            //         },
            //         emphasis: {
            //             show: true
            //         }
            //     },
            //     itemStyle: {
            //         normal: {
            //             color: shineIng
            //         }
            //     }
            // },
            {
                type: 'map',
                map: 'china',
                geoIndex: 0,
                aspectScale: 0.75, //长宽比
                showLegendSymbol: false, // 存在legend时显示
                label: {
                    normal: {
                        show: true
                    },
                    emphasis: {
                        show: false,
                        textStyle: {
                            color: '#fff'
                        }
                    }
                },
                roam: true,
                itemStyle: {
                    normal: {
                        areaColor: '#031525',
                        borderColor: '#3B5077',
                    },
                    emphasis: {
                        areaColor: '#2B91B7'
                    }
                },
                animation: false,
                // data: data
            },
            {
                name: '点',
                type: 'scatter',
                coordinateSystem: 'geo',
                zlevel: 6,
            },
            {
                name: 'Top 5',
                type: 'effectScatter',
                coordinateSystem: 'geo',
                // data: this.convertData(data.sort(function (a, b) {
                //     return b.value - a.value;
                // }).slice(0, 10)),
                symbolSize: function (val) {
                    if (val[2] == 0) {
                        return 5
                    } else {
                        if (val[2] / 100 < 5) {
                            return 5
                        } else {
                            return val[2] / Maxsize;
                        }
                    }
                },
                showEffectOn: 'render',
                rippleEffect: {
                    brushType: 'stroke'
                },
                hoverAnimation: true,
                label: {
                    normal: {
                        formatter: '{b}',
                        position: 'left',
                        show: false
                    }
                },
                itemStyle: {
                    normal: {
                        color: '#FCD349',
                        shadowBlur: 10,
                        shadowColor: '#FCD349'
                    }
                },
                zlevel: 1
            },

            ]
        }

        function pointClick(param) {
            console.log(param)
        }
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
        myChart.resize()
        myChart.off('click');
        myChart.on('click', 'series',pointClick);
    </script>
</body>

</html>