function Certificate(b64CertOrCertInfo){var priData={certInfo:null,_parseCert:function(r){if(tcu.isFFKyLinFT()){return tcu.ffKylinFT.parseCert(r)}var t,e=TCACore.getInstance(),n={certStoreNameArr:["MY","Address"],b64Cert:r};n=tcu.json2Str(n);try{t=e.call("Certificate/parseCert",n)}catch(r){return TCACErr.throwErr(r,ERRMAP.CERTIFICATE_PARSE_ERROR),null}return t.certInfo}};if(this._keyStoreName="",this._keyStoreType="",this._keyStoreContainer="",this._keySpec=0,this._certStoreName="",tcu.isStr(b64CertOrCertInfo)){priData.certInfo=priData._parseCert(b64CertOrCertInfo),priData.certInfo.b64=b64CertOrCertInfo}else{if(!tcu.isObj(b64CertOrCertInfo)){return void TCACErr.throwErr(ERRMAP.CERTIFICATE_INIT_WRONGTYPE)}priData.certInfo=b64CertOrCertInfo}this._keyStoreName=priData.certInfo.keyStoreName,this._keyStoreType=priData.certInfo.keyStoreType,this._keyStoreContainer=priData.certInfo.certContainerName,this._keySpec=priData.certInfo.certKeySpec,this._certStoreName=priData.certInfo.certStoreName,this.serialNumber=function(){return priData.certInfo.SN},this.serialNumberDec=function(){return priData.certInfo.SNDEC},this.subject=function(){return priData.certInfo.subject.winDn},this.issuer=function(){return priData.certInfo.issuer.winDn},this.notBefore=function(){return priData.certInfo.notBefore},this.notAfter=function(){return priData.certInfo.notAfter},this.crlUrl=function(){return priData.certInfo.crlUrl},this.raXmno=function(){var extensions=priData.certInfo.extension;for(var index in extensions=eval(extensions),extensions){var oid=extensions[index].oid,value=extensions[index].value;if("1.2.156.102001.1.1"===oid){return value}}return""},this.entQykzno=function(){var extensions=priData.certInfo.extension;for(var index in extensions=eval(extensions),extensions){var oid=extensions[index].oid,value=extensions[index].value;if("1.2.156.102001.1.3"===oid){return value}}return""},this.entSbno=function(){var extensions=priData.certInfo.extension;for(var index in extensions=eval(extensions),extensions){var oid=extensions[index].oid,value=extensions[index].value;if("1.2.156.102001.1.4"===oid){return value}}return""},this.signAlg=function(){return tcu.convSignAlg2Str(priData.certInfo.signAlg)},this.publicKeyAlg=function(){return tcu.convPubKeyAlg2Str(priData.certInfo.pubKeyAlg)},this.publicKeySize=function(){return tcu.convPubKeyAlg2Size(priData.certInfo.pubKeyAlg)},this.keyUsage=function(){return tcu.convKeyUsageNum2Arr(priData.certInfo.keyUsage)},this.extededKeyUsage=function(){return tcu.convExtKeyUsageOID2Name(priData.certInfo.extKeyUsage)},this.toBase64=function(){return priData.certInfo.b64},this.clearPinCache=function(){var certB64=this.toBase64();var certContainerName=priData.certInfo.certContainerName;var keyStoreName=priData.certInfo.keyStoreName;var resp;try{if(tcu.isFFKyLinFT()){var certB64=this.toBase64();return tcu.ffKylinFT.clearPinCache(keyStoreName,certB64)}return tcu.clearPinCache(keyStoreName)}catch(e){TCACErr.throwErr(e,ERRMAP.CLEAR_PIN_CACHE_ERROR);return null}},this.signMessage=function(r,t,e,n){if(t=void 0===t||t,void 0===e){e="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SM3}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),e)){return null}}n=void 0===n?TCA.IO.U8:n;var i=TCACore.getInstance(),c=TCA.IO.MSG|n,a=r,o=TCA.IO.MSG|TCA.IO.B64,s="noSet",u=tcu.tcaAlg2SDKAlg(e),l=i.getCfg("signPkcs7WithAttr"),A=[priData.certInfo.certID];if(tcu.isFFKyLinFT()){var C=this.toBase64();return tcu.ffKylinFT.sign(C,u,c,a,o,s,!1,!1,t)}if(tcu.isSKFProv(priData.certInfo.keyStoreName)&&this.publicKeyAlg()==TCA.SM2){var T,E=tcu.convProvName(priData.certInfo.keyStoreName);return null!=(T=tcu.skfSign(E,priData.certInfo.b64,u,!1,!0,l,t,!0,c,a,o,s))?T.result:null}return null!=(T=tcu.sign(["MY","Address"],A,u,!1,!0,l,t,!0,c,a,o,s))?T.result:null},this.signMessageRaw=function(r,t,e){if(void 0===t){t="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SM3}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),t)){return null}}e=void 0===e?TCA.IO.U8:e;var n=TCA.IO.MSG|e,i=r,c=TCA.IO.MSG|TCA.IO.B64,a="noSet",o=tcu.tcaAlg2SDKAlg(t),s=[priData.certInfo.certID];if(tcu.isFFKyLinFT()){var u=this.toBase64();return tcu.ffKylinFT.sign(u,o,n,i,c,a,!0,!1,!1)}if(tcu.isSKFProv(priData.certInfo.keyStoreName)&&this.publicKeyAlg()==TCA.SM2){var l,A=tcu.convProvName(priData.certInfo.keyStoreName);return null!=(l=tcu.skfSign(A,priData.certInfo.b64,o,!1,!1,!1,!1,!1,n,i,c,a))?l.result:null}return null!=(l=tcu.sign(["MY","Address"],s,o,!1,!1,!1,!1,!1,n,i,c,a))?l.result:null},this.signFile=function(r,t,e,n,i){if(e=void 0===e||e,n=void 0===n?TCA.IO.BIN:n,void 0===i){i="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SM3}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),i)){return null}}var c=TCACore.getInstance(),a=TCA.IO.FILE|n,o=r,s=TCA.IO.FILE|n,u=t,l=tcu.tcaAlg2SDKAlg(i),A=c.getCfg("signPkcs7WithAttr"),C=[priData.certInfo.certID];if(tcu.isSKFProv(priData.certInfo.keyStoreName)&&this.publicKeyAlg()==TCA.SM2){var T,E=tcu.convProvName(priData.certInfo.keyStoreName);return null!=(T=tcu.skfSign(E,priData.certInfo.b64,l,!1,!0,A,e,!0,a,o,s,u))?T.result:null
}return null!=(T=tcu.sign(["MY","Address"],C,l,!1,!0,A,e,!0,a,o,s,u))},this.signFile2Msg=function(r,t,e,n){if(t=void 0===t||t,e=void 0===e?TCA.IO.BIN:e,void 0===n){n="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SM3}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),n)){return null}}var i=TCACore.getInstance(),c=TCA.IO.FILE|e,a=r,o=TCA.IO.MSG|TCA.IO.B64,s=tcu.tcaAlg2SDKAlg(n),u=i.getCfg("signPkcs7WithAttr"),l=[priData.certInfo.certID];if(tcu.isSKFProv(priData.certInfo.keyStoreName)&&this.publicKeyAlg()==TCA.SM2){var A,C=tcu.convProvName(priData.certInfo.keyStoreName);return null!=(A=tcu.skfSign(C,priData.certInfo.b64,s,!1,!0,u,t,!0,c,a,o,"noset"))?A.result:null}return null!=(A=tcu.sign(["MY","Address"],l,s,!1,!0,u,t,!0,c,a,o,"noset"))?A.result:null},this.signFileRaw=function(r,t,e){if(t=void 0===t?TCA.IO.BIN:t,void 0===e){e="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SM3}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),e)){return null}}var n=TCA.IO.FILE|t,i=r,c=TCA.IO.MSG|TCA.IO.B64,a=tcu.tcaAlg2SDKAlg(e),o=[priData.certInfo.certID];if(tcu.isSKFProv(priData.certInfo.keyStoreName)&&this.publicKeyAlg()==TCA.SM2){var s,u=tcu.convProvName(priData.certInfo.keyStoreName);return null!=(s=tcu.skfSign(u,priData.certInfo.b64,a,!1,!1,!1,!1,!1,n,i,c,"noSet"))?s.result:null}return null!=(s=tcu.sign(["MY","Address"],o,a,!1,!1,!1,!1,!1,n,i,c,"noSet"))?s.result:null},this.encryptMessage=function(r,t){void 0===t&&(t="SM2"==this.publicKeyAlg()?TCA.SM4:TCA.DES3,t=tcu.tcaAlg2SDKAlg(t));var e=[this.toBase64()],n=TCA.IO.MSG|TCA.IO.U8,i=r,c=TCA.IO.MSG|TCA.IO.B64;if(tcu.isFFKyLinFT()){var a,o=this.toBase64();return(a=tcu.ffKylinFT.enc(o,n,i,c,"noSet",!1,t)).result}return null!=(a=tcu.enc(e,t,!0,n,i,c,"noSet"))?a.result:null},this.encryptMessageRaw=function(r){var t=[this.toBase64()],e=TCA.IO.MSG|TCA.IO.U8,n=r,i=TCA.IO.MSG|TCA.IO.B64,c=tcu.tcaAlg2SDKAlg(TCA.SM4);if(tcu.isFFKyLinFT()){var a,o=this.toBase64();return(a=tcu.ffKylinFT.enc(o,e,n,i,"noSet",!0,c)).result}return null!=(a=tcu.enc(t,c,!1,e,n,i,"noSet"))?a.result:null},this.encryptFile=function(r,t,e,n){e=void 0===e?TCA.IO.BIN:e,n=tcu.tcaAlg2SDKAlg(TCA.SM4);var i=[this.toBase64()],c=TCA.IO.FILE|e,a=r,o=TCA.IO.FILE|e;return null!=tcu.enc(i,n,!0,c,a,o,t)||null},this.verifyMessageRaw=function(r,t,e,n){if(void 0===e){e="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SHA256}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),e)){return null}}n=void 0===n?TCA.IO.U8:n;var i=this.toBase64(),c=TCA.VERIFYOPT.CONTEXT_IN_INPUT|TCA.VERIFYOPT.CERT_IN_INPUT,a=TCA.IO.MSG|TCA.IO.B64,o=r,s=TCA.IO.MSG|n,u=tcu.tcaAlg2SDKAlg(e);if(tcu.isFFKyLinFT()){var l,A=this.toBase64();return !!(l=tcu.ffKylinFT.verify(A,s,t,a,o,!0,c,u,!1)).verifyResult&&l.verifyResult}return null!=(l=tcu.verify(i,!1,!1,u,c,a,o,s,t))&&l.verifyResult},this.verifyFileRaw=function(r,t,e,n){if(void 0===n){n="RSA"===this.publicKeyAlg()?TCA.SHA1:TCA.SHA256}else{if(!tcu.checkHashAlg(this.publicKeyAlg(),n)){return null}}var i=this.toBase64(),c=TCA.VERIFYOPT.CONTEXT_IN_INPUT|TCA.VERIFYOPT.CERT_IN_INPUT,a=TCA.IO.MSG|TCA.IO.B64,o=r,s=TCA.IO.FILE|TCA.IO.BIN,u=tcu.tcaAlg2SDKAlg(n),l=tcu.verify(i,!1,!1,u,c,a,o,s,t);return null!=l&&l.verifyResult},this.decryptMessageRaw=function(r){var t=[priData.certInfo.certID],e=TCA.IO.MSG|TCA.IO.B64,n=r,i=TCA.IO.MSG|TCA.IO.U8;if(tcu.isFFKyLinFT()){var c,a=this.toBase64();return null!=(c=tcu.ffKylinFT.dec(!1,e,n,i,"noSet",a))?c.result:null}return null!=(c=tcu.dec(["MY","Address"],t,!1,e,n,i,"noSet"))?c.result:null},this.deleteCert=function(){var r,t=[priData.certInfo.certID],e=TCACore.getInstance(),n='{"certStore" : ["MY", "Address"], "certIDArr" : ["'+t+'"]}';try{r=e.call("Certificate/deleteCert",n)}catch(r){return TCACErr.throwErr(r,ERRMAP.CERTIFICATE_DELETE_ERROR),!1}return null!=r},this.signLogonData=function(r){return this.signMessage("LOGONDATA:"+r)},this.signFile2File=this.signFile,this.signLogondata=this.signLogonData,this.encryptRaw=this.encryptMessageRaw,this.verifyFile=function(r,t,e){return null,TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.verifyRaw=this.verifyMessageRaw,this.Delete=this.deleteCert,this.b64str=this.toBase64,this.exportPFX=function(r){return null,TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.exportPFX2File=function(r,t){return null,TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.show=function(){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null}}function CertSet(r){var i={certArr:[]};if(r instanceof Array){if(0!=r.length){if(r[0] instanceof Certificate){i.certArr=r}else{if(!tcu.isStr(r[0])){return void TCACErr.throwErr(ERRMAP.CERT_SET_INIT_ERROR_TYPE)}for(var t=0;t<r.length;t++){i.certArr.push(new Certificate(r[t]))}}}}else{if(tcu.isStr(r)){i.certArr.push(new Certificate(r))}else{if(r instanceof Pkcs7){return void TCACErr.throwErr(ERRMAP.CERT_SET_INIT_ERROR_TYPE_2)}if(r instanceof Certificate){i.certArr.push(r)}else{if(0!=arguments.length){return void TCACErr.throwErr(ERRMAP.CERT_SET_INIT_ERROR_TYPE_3)}}}}this.size=function(){return i.certArr.length},this.get=function(r){return i.certArr[r]},this.bySerialnumber=function(r){for(var t=0;
t<i.certArr.length;t++){if(i.certArr[t].serialNumber()===r.toUpperCase()){return new CertSet(i.certArr[t])}}return new CertSet},this.bySubject=function(r){for(var t=[],e=0;e<i.certArr.length;e++){0<=i.certArr[e].subject().search(r)&&t.push(i.certArr[e])}return 0==t.length?new CertSet:new CertSet(t)},this.byIssuer=function(r){for(var t=[],e=0;e<i.certArr.length;e++){0<=i.certArr[e].issuer().search(r)&&t.push(i.certArr[e])}return 0==t.length?new CertSet:new CertSet(t)},this.byValidity=function(r){for(var t=0==arguments.length?new Date:new Date(date),e=[],n=0;n<i.certArr.length;n++){i.certArr[n].notBefore()<=t&&t<=i.certArr[n].notAfter()&&e.push(i.certArr[n])}return 0==e.length?new CertSet:new CertSet(e)},this.byKeyUsage=function(r){var t=0;if(r instanceof Array){t=tcu.convKeyUsageArr2Num(r)}else{if(!tcu.isNum(r)){return TCACErr.throwErr(ERRMAP.CERT_SET_FILTER_KEYUSAGE_ERROR),null}t=r}for(var e=[],n=0;n<i.certArr.length;n++){(tcu.convKeyUsageArr2Num(i.certArr[n].keyUsage())&t)==t&&e.push(i.certArr[n])}return 0==e.length?new CertSet:new CertSet(e)},this.forSign=function(){return this.byKeyUsage(128)},this.forEncrypt=function(){return this.byKeyUsage(32)},this.bySubjcet=this.bySubject,this.encryptMessage=function(r,t){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.encryptFile=function(r,t,e,n){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.uiSelect=function(){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null}}function CertStore(r,t){if(!tcu.isStr(r)||!tcu.isNum(t)){return TCACErr.throwErr(ERRMAP.CERTSTORE_INIT_WRONGTYPE),null}var e=TCACore.getInstance();r=e.getCfg("useAlias")?e.alias2Full(r):r;var I={};function p(){tcu.clearStore(r,t)}I.storeName=r,I.storeType=t,this.clearStore=function(){p()},this.genCsr=function(r,t){var e,n,i=TCACore.getInstance(),c=1,a="topca",o=i.getCfg("genKeySpec"),s=i.getCfg("exportKeyAble")?1:0,u="noSet",l=i.getCfg("genCsrUseSHA256")?TCA.SHA256:TCA.SHA1;if(tcu.isFFKyLinFT()){if(1!==arguments.length){return 2!==arguments.length?0!==arguments.length?(TCACErr.throwErr(ERRMAP.GEN_CSR_ERROR_PARAMS),null):(c=1,e=tcu.tcaAlg2SDKAlg(TCA.SM2),n=tcu.tcaAlg2SDKAlg(TCA.SM3),new Csr((R=tcu.ffKylinFT.genCsr(!0,"",n,e)).csrInfo)):(c=1,a=t,e=tcu.tcaAlg2SDKAlg(r),n=r==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l),new Csr((R=tcu.ffKylinFT.genCsr(!0,"",n,e)).csrInfo))}if(tcu.isStr(r)){return e=tcu.tcaAlg2SDKAlg(r),n=r==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l),new Csr((R=tcu.ffKylinFT.genCsr(!0,"",n,e)).csrInfo)}if(r instanceof Certificate){var A=r.publicKeyAlg(),C=r.publicKeySize();if("RSA"===A&&1024===C){S=TCA.RSA1024}else{if("RSA"==A&&2048===C){S=TCA.RSA2048}else{if("SM2"!=A){return TCACErr.throwErr(ERRMAP.GEN_CSR_ERR_PUBKEY_ALG),null}S=TCA.SM2}}return e=tcu.tcaAlg2SDKAlg(S),n=S==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l),o=r._keySpec,u=r._keyStoreContainer,new Csr((R=tcu.ffKylinFT.genCsr(!1,u,n,e)).csrInfo)}return TCACErr.throwErr(ERRMAP.GEN_CSR_ERROR_PARAMS),null}for(var T=["Longmai mToken GM3000 for HNCA CSP V1.1","Longmai","HSIC SKF CSP For HD Provider","HSIC","HaiTai Cryptographic Service Provider 20522","HaiTai SKF 20522 For HunanCA"],E=!1,f=0;f<T.length&&!(E=I.storeName==T[f]);f++){}if(E){return function(r,t,e){0==r.indexOf("Longmai")&&(r="Longmai"),0==r.indexOf("HSIC")&&(r="HSIC"),0==r.indexOf("HaiTai")&&(r="HaiTai SKF 20522 For HunanCA"),void 0===e&&(e="topca");var n=tcu.tcaAlg2SDKAlg(t),i=t==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(TCA.SHA1),c=TCACore.getInstance(),a=1;t instanceof Certificate&&(a=2,e=t.toBase64());var o,s='{"mode" : '+a+',"subject" : "'+e+'","provName" : "'+r+'","containerName" : "","keyAlg" :'+n+',"hashAlg" : '+i+',"certId" : ""}';try{o=c.call("skf/skfGenCsrHdl",s)}catch(r){return TCACErr.throwErr(r,ERRMAP.GEN_CSR_ERROR),null}return new Csr(o.csrInfo)}(I.storeName,r,t)}if(1===arguments.length){if(tcu.isStr(r)){p(),c=1,e=tcu.tcaAlg2SDKAlg(r),n=r==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l)}else{if(!(r instanceof Certificate)){return TCACErr.throwErr(ERRMAP.GEN_CSR_ERROR_PARAMS),null}var S;A=r.publicKeyAlg(),C=r.publicKeySize();if("RSA"===A&&1024===C){S=TCA.RSA1024}else{if("RSA"==A&&2048===C){S=TCA.RSA2048}else{if("SM2"!=A){return TCACErr.throwErr(ERRMAP.GEN_CSR_ERR_PUBKEY_ALG),null}S=TCA.SM2}}c=2,e=tcu.tcaAlg2SDKAlg(S),n=S==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l),o=r._keySpec,u=r._keyStoreContainer}}else{if(2===arguments.length){p(),c=1,a=t,e=tcu.tcaAlg2SDKAlg(r),n=r==TCA.SM2?tcu.tcaAlg2SDKAlg(TCA.SM3):tcu.tcaAlg2SDKAlg(l)}else{if(0!==arguments.length){return TCACErr.throwErr(ERRMAP.GEN_CSR_ERROR_PARAMS),null}p(),c=1,e=tcu.tcaAlg2SDKAlg(TCA.SM2),n=tcu.tcaAlg2SDKAlg(TCA.SM3)}}u=u.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\"/g,'\\"').replace(/\\/g,"\\\\");var R,g='{"mode" : '+c+',"subject" : "'+a+'","provName" : "'+I.storeName+'","provType" : '+I.storeType+',"containerName" : "'+u+'","keySpec" :'+o+',"keyAlg" :'+e+',"hashAlg" : '+n+',"opation" : '+s+"}";try{R=i.call("Csr/genCsr",g)
}catch(r){return TCACErr.throwErr(r,ERRMAP.GEN_CSR_ERROR),null}return new Csr(R.csrInfo)},this.listCerts=function(){for(var r=CertStore.listAllCerts(),t=[],e=0;e<r.size();e++){var n=r.get(e);n._keyStoreName===I.storeName&&t.push(n)}return new CertSet(t)},this.getSupportedKeyAlgs=function(){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.importPFX=function(r,t){return null,TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.importPFXFile=function(r,t){return null,TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},this.name=function(){return I.storeName}}CertStore.listAllCerts=function(){if(tcu.isFFKyLinFT()){return tcu.ffKylinFT.listAllCerts()}for(var r=TCACore.getInstance(),t=["MY","Address"],e=[],n=0;n<t.length;n++){var i='{"certStoreName" : "'+t[n]+'", "needB64" : true}',c=null;try{c=r.call("CertStore/listCerts",i)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_CERT_ERROR),new CertSet}for(var a=c.certArr,o=0;o<a.length;o++){a[o].notBefore=new Date(a[o].notBefore),a[o].notAfter=new Date(a[o].notAfter);var s=new Certificate(a[o]);r.certInLic(s)&&e.push(s)}}return new CertSet(e)},CertStore.listStore=function(r){var t;t=tcu.isFFKyLinFT()?tcu.ffKylinFT.listKeyStore():CertStore.listKeyStore(r);for(var e=[],n=0;n<t.length;n++){e.push(t[n].name)}return e},CertStore.byName=function(r){var t;t=tcu.isFFKyLinFT()?tcu.ffKylinFT.listKeyStore():CertStore.listKeyStore();for(var e=0;e<t.length;e++){if(r===t[e].name){return new CertStore(t[e].name,t[e].type)}}return null},CertStore.byCert=function(r){return r instanceof Certificate?new CertStore(r._keyStoreName,r._keyStoreType):(TCACErr.throwErr(ERRMAP.BY_CERT_ERR_TYPE),null)},CertStore.installCert=function(r,t,e){if(tcu.isFFKyLinFT()){if(1==arguments.length){return new Certificate((C=tcu.ffKylinFT.installSign(r)).certAndKeyInfo.cert.b64)}if(3!==arguments.length){return TCACErr.throwErr(ERRMAP.INSTALL_CERT_ERR_PARAMS),null}for(var n=e.split("&"),i={},c=0;c<n.length;c++){i[(E=n[c].split("="))[0]]=tcu.urlDec(E[1])}var a=i.userSeal,o=i.encPrivateKeyUser,s=i.userCipher,u=i.userIV;switch(s){case"AES":case"AES_128":f=TCA.AES;break;case"DES":f=TCA.DES;break;case"DESEDE":case"DES3":case"3DES":f=TCA.DES3;break;case"SM4":case"SMS4":f=TCA.SM4;break;case"SM1":f=TCA.SM1;break;case"rc2":case"AES_192":case"AES_256":return TCACErr.throwErr(ERRMAP.INSTALL_CERT_ERR_UNKNOWN_SYMMALG),null;default:f=TCA.AES}return f=tcu.tcaAlg2SDKAlg(f),new Certificate((C=tcu.ffKylinFT.installEnc(r,t,a,u,f,o)).certAndKeyInfo.cert.b64)}var l,A,C,T=TCACore.getInstance();if(1===arguments.length){l="InstallSignCert/installSignCert",A='{"certStoreName"   : "MY", "caCertStoreName" : "Ca", "b64SignCertP7"   : "'+r+'"}'}else{if(3!==arguments.length){return TCACErr.throwErr(ERRMAP.INSTALL_CERT_ERR_PARAMS),null}l="InstallEncCert/installEncCert";for(n=e.split("&"),i={},c=0;c<n.length;c++){var E;i[(E=n[c].split("="))[0]]=tcu.urlDec(E[1])}var f;a=i.userSeal,o=i.encPrivateKeyUser,s=i.userCipher,u=i.userIV;switch(s){case"AES":case"AES_128":f=TCA.AES;break;case"DES":f=TCA.DES;break;case"DESEDE":case"DES3":case"3DES":f=TCA.DES3;break;case"SM4":case"SMS4":f=TCA.SM4;break;case"SM1":f=TCA.SM1;break;case"rc2":case"AES_192":case"AES_256":return TCACErr.throwErr(ERRMAP.INSTALL_CERT_ERR_UNKNOWN_SYMMALG),null;default:f=TCA.AES}f=tcu.tcaAlg2SDKAlg(f);var S=new Certificate(r)._keyStoreName;A='{"certStoreName" : "MY", "mode" : '+(0<=S.indexOf("Microsoft")||0<=S.indexOf("iTrus")||"RSA"==S?1:T.getCfg("installMode")?2:1)+', "b64SignCert" : "'+r+'", "b64UserSeal" : "'+a+'", "b64EncUserCert" : "'+t+'", "b64EncUserPrivateKey" : "'+o+'", "symmAlg" : '+f+', "b64IV" : "'+u+'"}'}try{C=T.call(l,A)}catch(r){return TCACErr.throwErr(r,ERRMAP.INSTALL_CERT_ERR),null}return C.onlyCertChain?null:new Certificate(C.certInfo)},CertStore.listKeyStore=function(r){var t=TCACore.getInstance(),e=null;try{e=t.call("KeyStore/listKeyStore",'{"mode" : 1 }')}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}var n=e.keyStoreArr;t.setKeyStoreListCache(n),r=!t.getCfg("disableWhiteList")&&r;for(var i=t.getCfg("whiteList"),c=t.getCfg("useAlias"),a=[],o=0;o<n.length;o++){var s=n[o].name;r?tcu.strInList(s,i)&&a.push({name:c?t.full2Alias(s):s,type:n[o].type}):a.push({name:c?t.full2Alias(s):s,type:n[o].type})}return a};var CryptoUtil={};function Csr(r){var t={csrInfo:null};tcu.isObj(r)?t.csrInfo=r:TCACErr.throwErr(ERRMAP.CSR_INIT_ERROR_TYPE),this.subject=function(){return t.csrInfo.subject.winDN},this.toBase64=function(){return t.csrInfo.b64}}function Pkcs7(r){var t,o={pkcs7Info:null};if(!tcu.isStr(r)){return TCACErr.throwErr(ERRMAP.PKCS7_INIT_ERROR_TYPE),null}if(tcu.isFFKyLinFT()){(t=tcu.ffKylinFT.parseP7(r)).pkcs7Info=t}else{var e='{"inType" : '+(TCA.IO.MSG|TCA.IO.B64)+', "inParam" : "'+r+'", "certs" : true, "content" : true, "b64" : false}',n=TCACore.getInstance();try{t=n.call("Pkcs7/parsePkcs7",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_CERT_ERROR),null}}o.pkcs7Info=t.pkcs7Info,o.pkcs7Info.b64=r,this.verifyMessage=function(r){var t,e=TCA.VERIFYOPT.CERT_IN_P7,n=TCA.IO.MSG|TCA.IO.U8;
t=null!=r?(e|=TCA.VERIFYOPT.CONTEXT_IN_INPUT,r):(e|=TCA.VERIFYOPT.CONTEXT_IN_P7,"noSet");var i,c=TCA.IO.MSG|TCA.IO.B64,a=o.pkcs7Info.b64;return tcu.isFFKyLinFT()?(i=tcu.ffKylinFT.verify("",n,t,c,a,!1,e,1,!1)).verifyResult?new Certificate(i.resultCert):null:null===(i=tcu.verify("",!1,!0,1,e,c,a,n,t))?null:i.verifyResult?new Certificate(i.b64Cert):null},this.decryptMessage=function(){var r,t=TCA.IO.MSG|TCA.IO.B64,e=o.pkcs7Info.b64,n=TCA.IO.MSG|TCA.IO.U8;return tcu.isFFKyLinFT()?(r=tcu.ffKylinFT.dec(!0,t,e,n,"noSet","")).result:null!=(r=tcu.dec(["MY","Address"],[],!0,t,e,n,"noSet"))?r.result:null},this.contentMessage=function(){return o.pkcs7Info.isSigned&&o.pkcs7Info.hasContent?o.pkcs7Info.content:null},this.verify=this.verifyMessage,this.toBase64=function(){return o.pkcs7Info.b64}}CryptoUtil.random=function(r){var t=tcu.random(r);return null!=t?t.result:null},CryptoUtil.symmEnc=function(r,t,e,n){var i=TCA.IO.FILE|TCA.IO.BIN,c=n,a=TCA.IO.MSG|TCA.IO.B64;e=tcu.tcaAlg2SDKAlg(e);var o=tcu.symm(r,t,e,!0,i,c,a,"noSet");return null!=o?o.result:null},CryptoUtil.symmEncFile2File=function(r,t,e,n,i){var c=TCA.IO.FILE|TCA.IO.BIN,a=n,o=TCA.IO.FILE|TCA.IO.BIN,s=i;return e=tcu.tcaAlg2SDKAlg(e),null!=tcu.symm(r,t,e,!0,c,a,o,s)},CryptoUtil.symmDec=function(r,t,e,n,i){var c=TCA.IO.MSG|TCA.IO.B64,a=n,o=TCA.IO.FILE|TCA.IO.BIN,s=i;e=tcu.tcaAlg2SDKAlg(e);var u=tcu.symm(r,t,e,!1,c,a,o,s);return null!=u?u.result:null},CryptoUtil.symmDecFile2File=function(r,t,e,n,i){var c=TCA.IO.FILE|TCA.IO.BIN,a=n,o=TCA.IO.FILE|TCA.IO.BIN,s=i;return e=tcu.tcaAlg2SDKAlg(e),null!=tcu.symm(r,t,e,!1,c,a,o,s)},Pkcs7.verifyFile=function(r,t,e,n){var i,c=TCA.VERIFYOPT.CERT_IN_P7,a=TCA.IO.FILE|TCA.IO.BIN;i=null!=t?(c|=TCA.VERIFYOPT.CONTEXT_IN_INPUT,t):(c|=TCA.VERIFYOPT.CONTEXT_IN_P7,"noSet");var o=TCA.IO.FILE|TCA.IO.BIN,s=r,u=tcu.verify("",!1,!0,1,c,o,s,a,i);return tcu.isFFKyLinFT()?(u=tcu.ffKylinFT.verify("",a,i,o,s,!1,c,1,!1)).verifyResult?new Certificate(u.resultCert):null:null===u?null:u.verifyResult?new Certificate(u.b64Cert):null},Pkcs7.verifyFileEx=function(r,t,e,n){var i,c=TCA.VERIFYOPT.CERT_IN_P7|TCA.VERIFYOPT.CONTEXT_IN_INPUT,a=TCA.IO.FILE|TCA.IO.BIN,o=t,s=TCA.IO.MSG|TCA.IO.B64,u=r;return tcu.isFFKyLinFT()?(i=tcu.ffKylinFT.verify("",a,o,s,u,!1,c,1,!1)).verifyResult?new Certificate(i.resultCert):null:null===(i=tcu.verify("",!1,!0,1,c,s,u,a,o))?null:i.verifyResult?new Certificate(i.b64Cert):null},Pkcs7.contentFile=function(r,t,e){return TCACErr.throwErr(ERRMAP.UNIMPLEMENTED),null},Pkcs7.decryptFile=function(r,t,e){e=void 0===e?TCA.IO.BIN:e;var n=TCA.IO.FILE|e,i=r,c=TCA.IO.FILE|e,a=t;return null!=tcu.dec(["MY","Address"],[""],!0,n,i,c,a)};var TCA={config:function(r){TCACore.getInstance(r)},SM1:"SM1",SM4:"SM4",DES:"DES",DES3:"3DES",AES:"AES",RC4:"RC4",SM2:"SM2",RSA1024:"RSA1024",RSA2048:"RSA2048",SHA256:"SHA256",SHA1:"SHA1",SM3:"SM3",MD5:"MD5",digitalSignature:128,nonRepudiation:64,keyEncipherment:32,dataEncipherment:16,keyAgreement:8,keyCertSign:4,cRLSign:2,encipherOnly:1,decipherOnly:32768,contentCommitment:64,serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",ipsecEndSystem:"1.3.6.1.5.5.7.3.5",ipsecTunnel:"1.3.6.1.5.5.7.3.6",ipsecUser:"1.3.6.1.5.5.7.3.7",timeStamping:"1.3.6.1.5.5.7.3.8",OCSPSigning:"1.3.6.1.5.5.7.3.9",dvcs:"1.3.6.1.5.5.7.3.10",sbgpCertAAServerAuth:"1.3.6.1.5.5.7.3.11",scvpResponder:"1.3.6.1.5.5.7.3.12",eapOverPPP:"1.3.6.1.5.5.7.3.13",eapOverLAN:"1.3.6.1.5.5.7.3.14",scvpServer:"1.3.6.1.5.5.7.3.15",scvpClient:"1.3.6.1.5.5.7.3.16",ipsecIKE:"1.3.6.1.5.5.7.3.17",capwapAC:"1.3.6.1.5.5.7.3.18",capwapWTP:"1.3.6.1.5.5.7.3.19",smartcardlogon:"1.3.6.1.4.1.311.20.2.2",EX:{}};TCA.EX.szOID_RSA_MD5RSA="1.2.840.113549.1.1.4",TCA.EX.szOID_RSA_SHA1RSA="1.2.840.113549.1.1.5",TCA.EX.szOID_SM2_SM3SM2="1.2.156.10197.1.501",TCA.EX.INPUT_BASE64=1,TCA.EX.INPUT_HEX=2,TCA.EX.OUTPUT_BASE64=4,TCA.EX.OUTPUT_HEX=8,TCA.EX.INNER_CONTENT=16,TCA.EX.PLAINTEXT_UTF8=32,TCA.EX.ONLY_SIGNATURE=512,TCA.EX._pta_OverlapPeriod=30,TCA.EX.FUNCOPT_NOALERT=2147483648,TCA.EX.PARAM_FILENAME=4096,TCA.EX.PARAM_STRING=8192,TCA.EX.PTA_CALG_SHA256=2097152,TCA.EX.PFX_BASE64=8,TCA.EX.SIGNOPTION_P7=1,TCA.EX.SIGNOPTION_RAW=2,TCA.EX.SIGNOPTION_P7_INNER_CONTEXT=256,TCA.EX.SIGNOPTION_P7_INNER_CERT=512,TCA.EX.SIGNOPTION_P7_INNER_AUTHATTR=1024,TCA.EX.PARAM_IN_FILE=1,TCA.EX.PARAM_IN_MSG=2,TCA.EX.PARAM_OUT_FILE=4,TCA.EX.PARAM_OUT_MSG=8,TCA.EX.PARAM_TO_U16=256,TCA.EX.PARAM_TO_U8=512,TCA.EX.PARAM_IN_B64=1024,TCA.EX.PARAM_OUT_B64=2048,TCA.EX.PARAM_INC_CERT=16777216,TCA.EX.PARAM_INC_CONTEXT=33554432,TCA.EX.SM2_SOFT_CSP_NAME="iTrusChina Cryptographic Service Provider v1.0.0",TCA.EX.CRYPT_EXPORTABLE=1,TCA.IO={},TCA.IO.MSG=1,TCA.IO.FILE=2,TCA.IO.SELFILE=4,TCA.IO.BIN=65536,TCA.IO.B64=131072,TCA.IO.HEX=262144,TCA.IO.U8=524288,TCA.VERIFYOPT={},TCA.VERIFYOPT.CONTEXT_IN_P7=1,TCA.VERIFYOPT.CONTEXT_IN_INPUT=2,TCA.VERIFYOPT.CERT_IN_P7=16,TCA.VERIFYOPT.CERT_IN_INPUT=32,TCA.EX.exkeyusagemap={"1.3.6.1.5.5.7.3.1":"serverAuth","1.3.6.1.5.5.7.3.2":"clientAuth","1.3.6.1.5.5.7.3.3":"codeSigning","1.3.6.1.5.5.7.3.4":"emailProtection","1.3.6.1.5.5.7.3.5":"ipsecEndSystem","1.3.6.1.5.5.7.3.6":"ipsecTunnel","1.3.6.1.5.5.7.3.7":"ipsecUser","1.3.6.1.5.5.7.3.8":"timeStamping","1.3.6.1.5.5.7.3.9":"OCSPSigning","1.3.6.1.5.5.7.3.10":"dvcs","1.3.6.1.5.5.7.3.11":"sbgpCertAAServerAuth","1.3.6.1.5.5.7.3.12":"scvpResponder","1.3.6.1.5.5.7.3.13":"eapOverPPP","1.3.6.1.5.5.7.3.14":"eapOverLAN","1.3.6.1.5.5.7.3.15":"scvpServer","1.3.6.1.5.5.7.3.16":"scvpClient","1.3.6.1.5.5.7.3.17":"ipsecIKE","1.3.6.1.5.5.7.3.18":"capwapAC","1.3.6.1.5.5.7.3.19":"capwapWTP","1.3.6.1.4.1.311.20.2.2":"smartcardlogon"},TCA.filter2Str=function(r){for(var t="",e=0;
e<r.length;e++){var n=r[e],i="";for(var c in n){i+=n[c]+"|"}t+=i}return t},TCA.doFileDialog=function(r,t,e,n){null==e&&TCACErr.throwErr(ERRMAP.ERROR_NULL_CALLBACK),null!==t&&tcu.isArr(t)||(t=[{typeTxt:"All(*.*)",typeExt:"*.*"}]);var i={isOpen:n,title:r,filter:TCA.filter2Str(t)};i=tcu.json2Str(i);var c=TCACore.getInstance();try{c.callAsyn("FileUtil/SelFile",i,function(r){var t=""!=r.result;e(t,r.result)})}catch(r){return TCACErr.throwErr(r,ERRMAP.ERROR_FILE_DIALOG),null}},TCA.showOpenDialog=function(r,t,e){null!==r&&""!==r||(r="打开"),TCA.doFileDialog(r,t,e,!0)},TCA.showSaveDialog=function(r,t,e){null!==r&&""!==r||(r="关闭"),TCA.doFileDialog(r,t,e,!1)};var TCACore=function(){var priData={};function saveConfig(r){function t(){return 0<window.navigator.userAgent.indexOf(" Linux x86_64")||0<window.navigator.userAgent.indexOf(" Linux aarch64")||0<window.navigator.userAgent.indexOf(" Linux mips64")}for(var e in priData.config={},priData.config.ajaxHdl=void 0!==r.ajaxHdl?r.ajaxHdl:tcu.ajax,priData.config.str2JsonHdl=void 0!==r.str2JsonHdl?r.str2JsonHdl:tcu.convStr2Json,priData.config.certkitClsID="40CAB063-EF31-4ff6-B512-E1E4E454EB19",priData.config.certKitSrvHost="127.0.0.1",priData.config.certKitSrvPort=t()?"19657":"9655",priData.config.certKitSrvUrl="https://"+priData.config.certKitSrvHost+":"+priData.config.certKitSrvPort+"/",t()&&(priData.config.certKitSrvUrl="http://"+priData.config.certKitSrvHost+":"+priData.config.certKitSrvPort+"/"),priData.config.certKitSrvVer="3.6.0.2",priData.config.certKitActiveXVer="3.6.0.2",priData.config.licver="3.6.0.2",priData.config.licsoftver="3.6.0.2",priData.config.useAlias=void 0===r.useAlias||r.useAlias,priData.config.disableExeUrl=void 0!==r.disableExeUrl&&r.disableExeUrl,void 0!==r.cspAlias?priData.config.cspAlias=r.cspAlias:priData.config.cspAlias={"RSA软证书":"Microsoft Enhanced Cryptographic Provider v1.0","飞天 ePass 3000 GM":"EnterSafe ePass3000GM CSP v1.0","华大智宝 SJK102":"CIDC Cryptographic Service Provider v3.0.0","SM2软证书":"iTrusChina Cryptographic Service Provider v1.0.0","神州龙芯":"ChinaCpu USB Key CSP v1.0"},priData.config.addCspAlias=void 0!==r.addCspAlias?r.addCspAlias:{},priData.config.addCspAlias){priData.config.cspAlias[e]=priData.config.addCspAlias[e]}priData.config.disableWhiteList=void 0!==r.disableWhiteList&&r.disableWhiteList,void 0!==r.whiteList?priData.config.whiteList=r.whiteList:priData.config.whiteList=["Microsoft Enhanced Cryptographic Provider v1.0","iTrusChina Cryptographic Service Provider v1.0.0"],priData.config.addWhiteList=void 0!==r.addWhiteList?r.addWhiteList:[];for(var n=0;n<priData.config.addWhiteList.length;n++){priData.config.whiteList.push(priData.config.addWhiteList[n])}priData.config.lic=void 0!==r.license?r.license:null,priData.config.licinfo=null,priData.config.urlArr=null,priData.config.autoExePath=void 0!==r.autoExePath&&r.autoExePath,priData.config.installMode=void 0===r.installMode||r.installMode,priData.config.exportKeyAble=void 0===r.exportKeyAble||r.exportKeyAble,void 0===r.exepath?priData.config.exepath=priData.config.selfPath+"TopCertKit-"+priData.config.exeVer+".exe":priData.config.exepath=r.exepath,priData.config.genKeySpec=void 0!==r.genKeySpec?r.genKeySpec:1,1!=priData.config.genKeySpec&&2!=priData.config.genKeySpec&&(priData.config.genKeySpec=1),priData.config.genCsrUseSHA256=void 0!==r.genCsrUseSHA256&&r.genCsrUseSHA256,priData.config.signPkcs7WithAttr=void 0!==r.signPkcs7WithAttr&&r.signPkcs7WithAttr,priData.config.enableAutoAuth=void 0!==r.enableAutoAuth&&r.enableAutoAuth,priData.config.autoAuthUrl=void 0!==r.autoAuthUrl?r.autoAuthUrl:""}function doGetEnct(){var r=TCACore.getInstance();try{resppriData.config.signPkcs7WithAttr=r.call("token/token",'{"method" : "gen","param1" : "", "param2" : "", "param3" : ""}')}catch(r){return TCACErr.throwErr(r,ERRMAP.AUTOAUTH_ERROR_2),null}return(void 0).retStr1}function doVerifyToken(r,t){var e='{"method" : "verify","param1" : "'+r+'", "param2" : "'+t+'", "param3" : ""}',n=TCACore.getInstance();try{n.call("token/token",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.AUTOAUTH_ERROR_2),!1}return !0}function verifyAutoAuth(){var r=priData.config.autoAuthUrl;""!==r&&null!=r||TCACErr.throwErr(ERRMAP.INVALID_CONFIG);var t=doGetEnct(),e="d={'winterIsComing': \""+t+'", \'v\' : "1"}';$.ajax({type:"post",async:!1,url:r,dataType:"json",data:e,success:function(r){ret=doVerifyToken(t,r.t)},error:function(r,t,e){ret=!1}}),ret?priData.config.licinfo={Issuer:".*"}:TCACErr.throwErr(ERRMAP.AUTOAUTH_ERROR)}function verifyLicense(){var pkcs7=new Pkcs7(priData.config.lic),cert=pkcs7.verifyMessage();"5F259CDACC82BB7EF305B3007B8B8EC9BDF9B5F2"!=cert.serialNumber()&&TCACErr.throwErr(ERRMAP.INVALID_LICENSE_2);var info=pkcs7.contentMessage();priData.config.licinfo=eval("("+info+")")}function gotoExeUrl(){if(priData.config.disableExeUrl){throw TCACErr.throwErr(ERRMAP.INSTALL_ACTIVEX_ERR)}window.location=priData.config.exepath}function loadCertKitSrv(){return !0}function getSrvVersion(){return !!tcu.isFFKyLinFT()||tcu.getSrvVersion().version
}function loadCertKitActiveX(){try{var r="<object id='TopCertKit' classid='clsid:"+priData.config.certkitClsID+"' ";r+="></object>";var t=document.getElementById("CertKitDiv");null!==t&&""!==t||((t=document.createElement("div")).setAttribute("id","CertKitDiv"),t.innerHTML=r,document.body.appendChild(t)),priData.certKitSrvActiveX=document.getElementById("TopCertKit")}catch(r){throw r}}function checkCertKitVer(){if(tcu.isFFKyLinFT()){return !0}var r=!1;return(r=isIE()?priData.certKitSrvActiveX.ver==priData.config.certKitActiveXVer:getSrvVersion()==priData.config.certKitActiveXVer)||TCACErr.throwErr(ERRMAP.INVALID_CERTKIT_VER),r}function isIE(){var r=navigator.userAgent;return 0<r.indexOf("MSIE")||-1<r.toLocaleLowerCase().indexOf("trident")}function loadCertKit(){return isIE()?loadCertKitActiveX():loadCertKitSrv()}function callSrv(r,t){var e=priData.config.certKitSrvUrl+r,n={},i=!1;if(priData.config.ajaxHdl({type:"POST",url:e,async:!1,contentType:"application/json; charset=utf-8",dataType:"json",data:t,success:function(r){i=!0,n=r},error:function(r,t,e){i=!1,n.request=r,n.status=t,n.err=e}}),!i){throw new TCACErr(4278190081,"["+n.request.readyState+"]["+n.request.status+"]["+n.status+"]["+n.err.toString()+"]")}return n.retCode!=ERRMAP.SUPER_SUCCESS.code&&TCACErr.throwErr(TCACErr.newErr(ERRMAP.CALL_HTTP_CLIENT_ERR),{code:n.retCode,msg:n.retMsg}),n}function callSrvAsyn(r,t,e){var n=priData.config.certKitSrvUrl+r,i={};priData.config.ajaxHdl({type:"POST",url:n,async:!0,contentType:"application/json; charset=utf-8",dataType:"json",data:t,success:function(r){!0,e(i=r)},error:function(r,t,e){TCACErr.throwErr(TCACErr.newErr(ERRMAP.CALL_HTTP_CLIENT_ERR),{code:i.retCode,msg:i.retMsg}),!1,i.request=r,i.status=t,i.err=e}})}function callActiveX(r,t){var e=null;try{r="/"+r,e=priData.certKitSrvActiveX.reqHdl(r,t)}catch(r){var n=TCACErr.newErr({code:r.number,msg:r.description});return TCACErr.throwErr(n,ERRMAP.CALL_ACTIVEX_ERR),null}if(0==(e=priData.config.str2JsonHdl(e)).retCode){return e}var i=TCACErr.newErr(ERRMAP.CALL_ACTIVEX_ERR_METHOD);return TCACErr.throwErr(i,{code:e.retCode,msg:e.retMsg}),null}function callActiveXAsyn(r,t,e){var n=null;try{r="/"+r,n=priData.certKitSrvActiveX.reqHdl(r,t)}catch(r){var i=TCACErr.newErr({code:r.number,msg:r.description});return TCACErr.throwErr(i,ERRMAP.CALL_ACTIVEX_ERR),null}if(0!=(n=priData.config.str2JsonHdl(n)).retCode){var c=TCACErr.newErr(ERRMAP.CALL_ACTIVEX_ERR_METHOD);return TCACErr.throwErr(c,{code:n.retCode,msg:n.retMsg}),null}e(n)}priData.config=null,priData.cacheKeyStoreList=null,priData.certKitSrvActiveX=null,saveConfig({});var instanceClass=function(){this.getCfg=function(r){return priData.config[r]},this.setKeyStoreListCache=function(r){priData.cacheKeyStoreList=r},this.getLicInfo=function(r){return priData.config.licinfo,priData.config.licinfo[r]},this.full2Alias=function(r){for(var t in priData.config.cspAlias){if(priData.config.cspAlias.hasOwnProperty(t)&&priData.config.cspAlias[t]==r){return t}}return r},this.alias2Full=function(r){var t=priData.config.cspAlias[r];return void 0===t?r:t},this.certInLic=function(r){return new RegExp(this.getLicInfo("Issuer")).test(r.issuer())};var n={};n.query=isIE()?callActiveX:callSrv,n.queryAsyn=isIE()?callActiveXAsyn:callSrvAsyn,this.call=function(r,t){return n.query(r,t)},this.callAsyn=function(r,t,e){return n.queryAsyn(r,t,e)}},_instance=null,getInstance=function(r){if(null!=r&&saveConfig(r),null===_instance){if(_instance=new instanceClass,loadCertKit(),!checkCertKitVer()){return void gotoExeUrl()}priData.config.enableAutoAuth?verifyAutoAuth():verifyLicense()}return _instance};return{getInstance:getInstance}}();function TCACErr(r){this._errarr=[],r instanceof TCACErr&&(this._errarr=r._errarr),this.addErr=function(r){var t=r.code,e=r.msg;this.number=0<t?t:4294967296+t,this.description=e,this._errarr.push({code:this.number.toString(16).toUpperCase(),msg:e})},this.toStr=function(){for(var r="",t=0;t<this._errarr.length;t++){r+=this._errarr[t].msg+", 错误码：0x"+this._errarr[t].code+", \r\n"}return r.substr(0,r.length-4)}}TCACErr.newErr=function(r,t){var e=null;return r instanceof TCACErr?(e=new TCACErr(r)).addErr(t):(e=new TCACErr).addErr(r),e},TCACErr.throwErr=function(r,t){throw r instanceof TCACErr?TCACErr.newErr(r,t):TCACErr.newErr(r)};var ERRMAP_ZHCN={CERTSTORE_INIT_WRONGTYPE:{code:16777217,msg:"CertStore实例初始化失败，参数类型不匹配"},LIST_STORE_ERROR:{code:16777218,msg:"列举密钥库错误"},CLEAR_PIN_CACHE_ERROR:{code:556466177,msg:"清除pin码缓存错误"},BY_CERT_ERR_TYPE:{code:16777219,msg:"根据证书获取CertStore实例时失败，参数类型不匹配"},LIST_CERT_ERROR:{code:16777220,msg:"列举证书错误"},GEN_CSR_ERROR_PARAMS:{code:16777221,msg:"产生CSR失败，输入参数错误"},GEN_CSR_ERR_PUBKEY_ALG:{code:16777222,msg:"产生CSR失败，未知的证书公钥算法"},GEN_CSR_ERROR:{code:16777223,msg:"产生CSR失败"},INSTALL_CERT_ERR_PARAMS:{code:16777224,msg:"安装证书失败，输入参数错误"},INSTALL_CERT_ERR_UNKNOWN_SYMMALG:{code:16777225,msg:"安装加密证书失败，未知的对称加密算法"},INSTALL_CERT_ERR:{code:16777226,msg:"安装证书失败"},CERTIFICATE_INIT_WRONGTYPE:{code:33554433,msg:"Certificate实例初始化失败，参数类型不匹配"},CERTIFICATE_PARSE_ERROR:{code:33554434,msg:"从Base64解析证书失败"},CERTIFICATE_DELETE_ERROR:{code:33554435,msg:"删除证书失败"},CERT_SET_INIT_ERROR_TYPE:{code:50331649,msg:"初始化CertSet实例失败，错误的输入类型"},CERT_SET_INIT_ERROR_TYPE_2:{code:50331650,msg:"初始化CertSet实例失败，错误的输入类型"},CERT_SET_INIT_ERROR_TYPE_3:{code:50331651,msg:"初始化CertSet实例失败，错误的输入类型"},CERT_SET_FILTER_KEYUSAGE_ERROR:{code:50331652,msg:"通过密钥用法过滤失败，错误的输入类型"},CSR_INIT_ERROR_TYPE:{code:67108865,msg:"初始化Csr实例失败，错误的输入类型"},PKCS7_INIT_ERROR_TYPE:{code:83886081,msg:"初始化Pkcs7实例失败，错误的输入类型"},PKCS7_INIT_PARSE_ERROR:{code:83886082,msg:"初始化Pkcs7实例失败，解析Pkcs7数据失败"},SIGN_ERROR:{code:2684354561,msg:"签名操作失败"},SIGN_ERROR_HASH_ALG:{code:100663297,msg:"哈希算法与签名算法不匹配"},VERIFY_ERROR:{code:2684354562,msg:"验证签名操作失败"},ENCRYPT_ERROR:{code:2684354563,msg:"加密操作失败"},DECRYPT_ERROR:{code:2684354564,msg:"解密操作失败"},ERROR_HASH_ALG:{code:2952790017,msg:"指定了错误的Hash算法算法"},ERROR_JSON_TYPE:{code:2952790018,msg:"错误的json类型"},ERROR_CALL_SRV_VER:{code:2952790019,msg:"查询服务版本失败"},CALL_HTTP_CLIENT_ERR:{code:4026531841,msg:"执行本地方法失败"},INVALID_LICENSE:{code:4026531842,msg:"使用了无效的License"},INVALID_CERTKIT_VER:{code:4026531843,msg:"不匹配的CertKit版本"},CALL_ACTIVEX_ERR:{code:4026531844,msg:"执行本地方法失败"},CALL_ACTIVEX_ERR_METHOD:{code:4026531845,msg:"执行操作失败"},INSTALL_ACTIVEX_ERR:{code:4026531846,msg:"无法加载ActiveX控件"},INVALID_LICENSE_2:{code:4026531847,msg:"使用了无效的License"},INVALID_CONFIG:{code:4026531848,msg:"无效的配置"},AUTOAUTH_ERROR:{code:4026531849,msg:"autoautherror"},AUTOAUTH_ERROR_2:{code:4026531850,msg:"autoautherror2"},ERROR_FILE_DIALOG:{code:218103810,msg:"打开对话框失败"},UNIMPLEMENTED:{code:1,msg:"未实现的方法"},BIG_ERROR:{code:4294967295,msg:"错误"},SUPER_SUCCESS:{code:0,msg:"成功"}},ERRMAP=ERRMAP_ZHCN;
function tcu(){}TCACErr.prototype=new Error,tcu.extKeyUsageMap={"1.3.6.1.5.5.7.3.1":"serverAuth","1.3.6.1.5.5.7.3.2":"clientAuth","1.3.6.1.5.5.7.3.3":"codeSigning","1.3.6.1.5.5.7.3.4":"emailProtection","1.3.6.1.5.5.7.3.5":"ipsecEndSystem","1.3.6.1.5.5.7.3.6":"ipsecTunnel","1.3.6.1.5.5.7.3.7":"ipsecUser","1.3.6.1.5.5.7.3.8":"timeStamping","1.3.6.1.5.5.7.3.9":"OCSPSigning","1.3.6.1.5.5.7.3.10":"dvcs","1.3.6.1.5.5.7.3.11":"sbgpCertAAServerAuth","1.3.6.1.5.5.7.3.12":"scvpResponder","1.3.6.1.5.5.7.3.13":"eapOverPPP","1.3.6.1.5.5.7.3.14":"eapOverLAN","1.3.6.1.5.5.7.3.15":"scvpServer","1.3.6.1.5.5.7.3.16":"scvpClient","1.3.6.1.5.5.7.3.17":"ipsecIKE","1.3.6.1.5.5.7.3.18":"capwapAC","1.3.6.1.5.5.7.3.19":"capwapWTP","1.3.6.1.4.1.311.20.2.2":"smartcardlogon"},tcu.isStr=function(r){return"string"==typeof r},tcu.isNum=function(r){return"number"==typeof r},tcu.isBool=function(r){return"boolean"==typeof r},tcu.isUndef=function(r){return void 0===r},tcu.isNull=function(r){return"null"==typeof r},tcu.isObj=function(r){return"object"==typeof r},tcu.isArr=function(r){return"[object Array]"===Object.prototype.toString.call(r)},tcu.urlDec=function(r){var t=decodeURIComponent(r);return t.replace(/[\r\n]/g,"")},tcu.convKeyUsageArr2Num=function(r){for(var t=0,e=0;e<r.length;e++){"digitalSignature"!=r[e]?"nonRepudiation"!=r[e]?"keyEncipherment"!=r[e]?"dataEncipherment"!=r[e]?"keyAgreement"!=r[e]?"keyCertSign"!=r[e]?"cRLSign"!=r[e]?"encipherOnly"!=r[e]?"decipherOnly"!=r[e]?"contentCommitment"==r[e]&&(t|=TCA.contentCommitment):t|=TCA.decipherOnly:t|=TCA.encipherOnly:t|=TCA.cRLSign:t|=TCA.keyCertSign:t|=TCA.keyAgreement:t|=TCA.dataEncipherment:t|=TCA.keyEncipherment:t|=TCA.nonRepudiation:t|=TCA.digitalSignature}return t},tcu.convKeyUsageNum2Arr=function(r){var t=[];return 0===r||(r&TCA.digitalSignature&&t.push("digitalSignature"),r&TCA.nonRepudiation&&t.push("nonRepudiation"),r&TCA.keyEncipherment&&t.push("keyEncipherment"),r&TCA.dataEncipherment&&t.push("dataEncipherment"),r&TCA.keyAgreement&&t.push("keyAgreement"),r&TCA.keyCertSign&&t.push("keyCertSign"),r&TCA.cRLSign&&t.push("cRLSign"),r&TCA.encipherOnly&&t.push("encipherOnly"),r&TCA.decipherOnly&&t.push("decipherOnly"),r&TCA.contentCommitment&&t.push("contentCommitment")),t},tcu.convSignAlg2Str=function(r){switch(r){case 81:return"SM3WithSM2";case 98:return"SHA1WithRSA"}return"UnknownSignAlg"},tcu.convAlg2SignAlgId=function(r){return r==TCA.RSA1024?98:r==TCA.RSA2048?98:r==TCA.SM2?81:-1},tcu.convPubKeyAlg2Str=function(r){switch(r){case 1:case 2:case 3:case 16:return"RSA";case 17:return"SM2"}return"UnknownAlg"},tcu.convPubKeyAlg2Size=function(r){switch(r){case 1:return 1024;case 2:return 2048;case 3:return 4096;case 17:return 256}return -1},tcu.convExtKeyUsageOID2Name=function(r){for(var t=[],e=0;e<r.length;e++){t.push(tcu.extKeyUsageMap[r[e]])}return t},tcu.convStr2Json=function(jsonStr){return eval("("+jsonStr+")")},tcu.convKeySize2CSP=function(r){return r==TCA.RSA1024?67108864:r==TCA.RSA2048?134217728:r==TCA.SM2?16777216:-1},tcu.strInList=function(r,t){if(t.length<=0){return !1}for(var e=0;e<t.length;e++){if(r===t[e]){return !0}}return !1},tcu.tcaAlg2SDKAlg=function(r){switch(r){case TCA.SM4:return 65;case TCA.DES:return 67;case TCA.DES3:return 68;case TCA.AES:return 69;case TCA.RC4:return 70;case TCA.SM2:return 17;case TCA.RSA1024:return 1;case TCA.RSA2048:return 2;case TCA.SHA256:return 50;case TCA.SHA1:return 49;case TCA.SM3:return 33;case TCA.MD5:return 51;case TCA.SM1:default:return 0}},tcu.arr2Str=function(r){for(var t="",e=0;e<r.length;e++){var n=r[e];t=t+'"'+(n=n.replace(/\r/g,"\\r").replace(/\n/g,"\\n"))+'", '}return 0<t.length&&(t=t.substr(0,t.length-2)),"["+t+"]"},tcu.json2Str=function(r){var t="{";for(var e in r){t+='"'+e+'":';var n=r[e];tcu.isStr(n)?t+='"'+(n=n.replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\"/g,'\\"').replace(/\\/g,"\\\\"))+'",':tcu.isNum(n)||tcu.isBool(n)?t+=n+",":tcu.isArr(n)?t+=tcu.arr2Str(n)+",":TCACErr.throwErr(ERRMAP.ERROR_JSON_TYPE)}return t+='"_jsonEnd":"_jsonEnd"}'},tcu.sign=function(r,t,e,n,i,c,a,o,s,u,l,A){var C={certStore:r,certIDArr:t,hash:e,bSignHash:n,bSignP7:i,bAttr:c,bIncCtx:a,bIncCert:o,inType:s,inParam:u,outType:l,outParam:A};C=tcu.json2Str(C);var T,E=TCACore.getInstance();try{T=E.call("Sign/sign",C)}catch(r){return TCACErr.throwErr(r,ERRMAP.SIGN_ERROR),null}return T},tcu.verify=function(r,t,e,n,i,c,a,o,s){var u={b64Cert:r,isHashSign:t,isPkcs7:e,hash:n,verifyOption:i,signInType:c,signInParam:a,plainInType:o,plainInParam:s};u=tcu.json2Str(u);var l,A=TCACore.getInstance();try{l=A.call("Verify/verify",u)}catch(r){return TCACErr.throwErr(r,ERRMAP.VERIFY_ERROR),null}return l},tcu.enc=function(r,t,e,n,i,c,a){var o={certArr:r,symmAlg:t,bEncP7:e,inType:n,inParam:i,outType:c,outParam:a};o=tcu.json2Str(o);var s,u=TCACore.getInstance();try{s=u.call("Enc/enc",o)}catch(r){return TCACErr.throwErr(r,ERRMAP.ENCRYPT_ERROR),null}return s},tcu.dec=function(r,t,e,n,i,c,a){var o={certStore:r,certIDArr:t,bIsP7:e,inType:n,inParam:i,outType:c,outParam:a};
o=tcu.json2Str(o);var s,u=TCACore.getInstance();try{s=u.call("skf/skfdec",o)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return s},tcu.checkHashAlg=function(r,t){if("SM2"===r&&t!=TCA.SM3||"RSA"===r&&t===TCA.SM3){return TCACErr.throwErr(ERRMAP.SIGN_ERROR_HASH_ALG)} return true;},tcu.getSrvVersion=function(){var r,t='{"outType" :'+TCA.IO.MSG+"}",e=TCACore.getInstance();try{r=e.call("Server/version",t)}catch(r){return TCACErr.throwErr(r,ERRMAP.ERROR_CALL_SRV_VER),null}return r},tcu.ajax=function(jsonParam){var url=jsonParam.url,data=jsonParam.data,successCallback=jsonParam.success,errorCallback=jsonParam.error,request=new XMLHttpRequest;try{if(request.open("POST",url,!1),request.setRequestHeader("Content-Type","application/json; charset=UTF-8"),request.send(data),200==request.status){if(tcu.isFFKyLinFT()){var r=request.responseText.substr(0,request.responseText.lastIndexOf("}")+1);return void successCallback(eval("("+r+")"))}return void successCallback(eval("("+request.responseText+")"))}}catch(r){return void errorCallback(request,request.statusText,"send error & no error thrown")}errorCallback(request,request.statusText,"no error thrown")},tcu.hash=function(r,t,e,n,i){var c={hash:r,inType:t,inParam:e,outType:n,outParam:i};c=tcu.json2Str(c);var a,o=TCACore.getInstance();try{a=o.call("Hash/hash",c)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return a},tcu.random=function(r){var t={byteLen:r};t=tcu.json2Str(t);var e,n=TCACore.getInstance();try{e=n.call("rand/rand",t)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return e},tcu.symm=function(r,t,e,n,i,c,a,o){var s={isEnc:n,b64Key:r,b64IV:t,symmAlg:e,inType:i,inParam:c,outType:a,outParam:o};s=tcu.json2Str(s);var u,l=TCACore.getInstance();try{u=l.call("symm/symm",s)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return u},tcu.clearStore=function(r,t){var e={providerName:r,providerType:t,param:"",mode:0};e=tcu.json2Str(e);var n=TCACore.getInstance();try{n.call("ukey/ukey",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),!1}return !0},tcu.skfCheckDriver=function(r,t){var e={parama:r,paramb:t};e=tcu.json2Str(e);var n,i=TCACore.getInstance();try{n=i.call("skf/skfCheckDriver",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return n},tcu.skfListStore=function(r,t){var e={driverNameList:r,driverList:t};e=tcu.json2Str(e);var n,i=TCACore.getInstance();try{n=i.call("skf/skfListStore",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return n},tcu.skfListCert=function(r,t,e,n,i){var c={providerPath:r,devName:t,appName:e,adminPin:n,userPin:i};c=tcu.json2Str(c);var a,o=TCACore.getInstance();try{a=o.call("skf/skfListCert",c)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return a},tcu.skfSign=function(r,t,e,n,i,c,a,o,s,u,l,A){var C={provName:r,b64Cert:t,hash:e,bSignHash:n,bSignP7:i,bAttr:c,bIncCtx:a,bIncCert:o,inType:s,inParam:u,outType:l,outParam:A};C=tcu.json2Str(C);var T,E=TCACore.getInstance();try{T=E.call("skf/skfSign",C)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return T},tcu.skfdec=function(r,t,e,n,i,c,a,o,s,u,l,A){var C={providerPath:r,devName:t,appName:e,adminPin:n,userPin:i,containerName:c,b64Cert:a,bIsP7:o,inType:s,inParam:u,outType:l,outParam:A};C=tcu.json2Str(C);var T,E=TCACore.getInstance();try{T=E.call("skf/skfdec",C)}catch(r){return TCACErr.throwErr(r,ERRMAP.DECRYPT_ERROR),null}return T},tcu.clearPinCache=function(keyStoreName){var a=TCACore.getInstance();var inParam={clid:"",method:"clearpin",params:[keyStoreName]};inParam=tcu.json2Str(inParam);try{return a.call("KeyCom/call",inParam)}catch(e){return TCACErr.throwErr(e,ERRMAP.CLEAR_PIN_CACHE_ERROR)}},tcu.isSKFProv=function(r){for(var t=["Longmai mToken GM3000 for HNCA CSP V1.1","Longmai","HSIC SKF CSP For HD Provider","HSIC","HaiTai Cryptographic Service Provider 20522","HaiTai SKF 20522 For HunanCA"],e=0;e<t.length;e++){if(r==t[e]){return !0}}return !1},tcu.convProvName=function(r){return 0==r.indexOf("Longmai")?"Longmai":0==r.indexOf("HSIC")?"HSIC":0==r.indexOf("HaiTai")?"HaiTai SKF 20522 For HunanCA":void 0},tcu.isFFKyLinFT=function(){return 0<window.navigator.userAgent.indexOf(" Linux x86_64")||0<window.navigator.userAgent.indexOf(" Linux aarch64")||0<window.navigator.userAgent.indexOf(" Linux mips64")},tcu.ffKylinFT={},tcu.ffKylinFT.F_IO_MSG=1,tcu.ffKylinFT.F_IO_FILE=2,tcu.ffKylinFT.F_IO_SELFILE=4,tcu.ffKylinFT.F_IO_BIN=65536,tcu.ffKylinFT.F_IO_B64=131072,tcu.ffKylinFT.F_IO_HEX=262144,tcu.ffKylinFT.F_IO_U8=524288,tcu.ffKylinFT.listKeyStore=function(r){var t=TCACore.getInstance(),e={mode:1,param:"11"};e=tcu.json2Str(e);var n=null;try{n=t.call("certStore/skfListProv",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}r=!t.getCfg("disableWhiteList")&&r;for(var i=t.getCfg("whiteList"),c=t.getCfg("useAlias"),a=[],o=n.cspDevInfos,s=0;s<o.length;s++){var u=o[s].name;r?tcu.strInList(u,i)&&a.push({name:c?t.full2Alias(u):u,type:o[s].type}):a.push({name:c?t.full2Alias(u):u,type:o[s].type})
}function l(r,t){var e=Object.getOwnPropertyNames(r),n=Object.getOwnPropertyNames(t);if(e.length!=n.length){return !1}for(var i=0;i<e.length;i++){var c=e[i];if(r[c]!==t[c]){return !1}}return !0}return function(r){if(!r){return null}for(var t=[],e=0;e<r.length;e++){for(var n=!0,i=r[e],c=0;c<t.length;c++){if(l(i,t[c])){return n=!1}}n&&t.push(i)}return t}(a)},tcu.ffKylinFT.convCertInfo=function(r){var t,e={};e=r.cert,t=(t=new Date(1000*e.notBefore).toString()).substr(0,t.lastIndexOf("+")),e.notBefore=new Date(t),t=(t=new Date(1000*e.notAfter).toString()).substr(0,t.lastIndexOf("+")),e.notAfter=new Date(t);var n=r.priKeyInfo;return e.keyStoreName=n.providerName,e.keyStoreType=1,e.certStoreName="Longmai",e.certContainerName=n.containerName,e.certKeySpec=n.isSignKey?2:1,e},tcu.ffKylinFT.listAllCerts=function(){for(var r=TCACore.getInstance(),t=CertStore.listStore(),e=[],n=0;n<t.length;n++){var i={certStoreName:t[n],needB64:!0};i=tcu.json2Str(i);var c=null;try{c=r.call("certStore/skfListCerts",i)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_CERT_ERROR),new CertSet}for(var a=c.certArr,o=0;o<a.length;o++){var s=a[o];s.priKeyInfo.providerName=t[n];var u=new Certificate(tcu.ffKylinFT.convCertInfo(s));r.certInLic(u)&&e.push(u)}}return new CertSet(e)},tcu.ffKylinFT.genCsr=function(r,t,e,n){var i=TCACore.getInstance(),c={mode:r?1:2,subject:"topca",provName:"Longmai",provType:1,containerName:t,keySpec:2,keyAlg:n,hashAlg:e,opation:1};c=tcu.json2Str(c);var a=null;try{a=i.call("certStore/skfGenCsr",c)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return a},tcu.ffKylinFT.parseCert=function(r){var t=TCACore.getInstance(),e={certStoreNames:["Longmai"],b64Cert:r};e=tcu.json2Str(e);var n=null;try{n=t.call("cert/skfParseCert",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}var i=n.certAndKeyInfo;return tcu.ffKylinFT.convCertInfo(i)},tcu.ffKylinFT.parseP7=function(r){var t=TCACore.getInstance(),e={inType:TCA.IO.MSG|TCA.IO.B64,inParam:r,needCerts:!0,needContent:!0,needB64:!1};e=tcu.json2Str(e);var n=null;try{n=t.call("pkcs7/parsePkcs7",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return n.pkcs7Info},tcu.ffKylinFT.sign=function(r,t,e,n,i,c,a,o,s){var u,l=TCACore.getInstance();u=a?{certStoreName:"Longmai",b64cert:r,hashAlg:t,inType:e,inParam:n,outType:i,outParam:c,plainIsHash:o}:{certStoreName:"Longmai",b64cert:r,hashAlg:t,inType:e,inParam:n,outType:i,outParam:c,incAttr:!1,IncCtx:s,IncCert:!0},u=tcu.json2Str(u);var A=null,C=a?"sign/skfSignRaw":"sign/skfSignPkcs7";try{A=l.call(C,u)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return A.result},tcu.ffKylinFT.verify=function(r,t,e,n,i,c,a,o,s){var u,l=TCACore.getInstance();u=c?{b64cert:r,hashAlg:o,plainInType:t,plainInParam:e,signInType:n,signInParam:i,plainIsHash:s}:{b64cert:r,plainInType:t,plainInParam:e,signInType:n,signInParam:i,verifyOption:a},u=tcu.json2Str(u);var A=null,C=c?"verify/verifyRawSign":"verify/verifyPkcs7Sign";try{A=l.call(C,u)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return A},tcu.ffKylinFT.enc=function(r,t,e,n,i,c,a){var o,s=TCACore.getInstance();o=c?{b64cert:r,inType:t,inParam:e,outType:n,outParam:i}:{b64cert:r,symmAlg:a,inType:t,inParam:e,outType:n,outParam:i},o=tcu.json2Str(o);var u=null,l=c?"enc/encRaw":"enc/encPkcs7";try{u=s.call(l,o)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return u},tcu.ffKylinFT.dec=function(r,t,e,n,i,c){var a,o=TCACore.getInstance();a=r?{certStoreNames:["Longmai"],inType:t,inParam:e,outType:n,outParam:i}:{certStoreName:"Longmai",b64cert:c,inType:t,inParam:e,outType:n,outParam:i},a=tcu.json2Str(a);var s=null,u=r?"dec/skfDecPkcs7":"dec/skfDecRaw";try{s=o.call(u,a)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return s},tcu.ffKylinFT.installSign=function(r){var t=TCACore.getInstance(),e={certStoreName:"Longmai",b64SignCertP7:r,b64SignCert:"",installCertChain:!0,saveUserCertToCSP:!0};e=tcu.json2Str(e);var n=null;try{n=t.call("certStore/skfInstallSignCert",e)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return n},tcu.ffKylinFT.installEnc=function(r,t,e,n,i,c){var a=TCACore.getInstance(),o={certStoreName:"Longmai",gmmode:!1,b64SignCert:r,b64EncCert:t,b64EncSymmKey:e,b64Iv:n,b64EncPrivateKey:c,symmAlg:i,option:0};o=tcu.json2Str(o);var s=null;try{s=a.call("certStore/skfInstallEncCert",o)}catch(r){return TCACErr.throwErr(r,ERRMAP.LIST_STORE_ERROR),[]}return s},tcu.ffKylinFT.clearPinCache=function(certStoreName,b64cert){var a=TCACore.getInstance();var inParam={"b64cert":b64cert,"certStoreName":certStoreName};inParam=tcu.json2Str(inParam);try{return a.call("certStore/skfPinCacheClear",inParam)}catch(e){if(e.number===556466177){return true}return TCACErr.throwErr(e,ERRMAP.CLEAR_PIN_CACHE_ERROR)}};